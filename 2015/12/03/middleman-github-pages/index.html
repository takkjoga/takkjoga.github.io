<!DOCTYPE html><html lang="ja"><head><meta charset="utf-8" /><meta content="IE=edge;chrome=1" http-equiv="X-UA-Compatible" /><meta content="initial-scale=1.0, user-scalable=no" name="viewport" /><title>middlemanとGitHub Pagesでブログを5分で開設！ほか盛りだくさん！ | いくら寝ても眠たい</title><meta description="  advent calendar のために、自分専用のブログを作ろう！  と思い立った方は、是非見て行ってくださいね( ω^ )    仕事で middleman を触る機会があったため、これを機にちょっとまとめてみました。    手元の環境は、以下です。    * Mac OSX 10.10.5 Yosemite  GitHub のアカウントが無い場合は、早速作っておきましょう。   アカウントが作れたら、ここを参考にSSH鍵の登録をしておきましょう。    今回はテンプレートに Drops" /><link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" /><link href="../../../../stylesheets/all-840b5610.css" rel="stylesheet" type="text/css" /><link href="../../../../images/favicon-6c3f3d04.png" rel="icon" type="image/png" /></head><body><header><div class="top-menu"><div class="top-menu-wrapper"><div class="top-menu-list"><ul><li><a href="/">Home</a></li><li><a href="/archives/">Archives</a></li><li><a href="/tags/">Tags</a></li><li><a href="/by-year/">By Year</a></li></ul></div><div class="feed"><a href="/feed.xml"><i class="fa fa-rss-square"></i></a></div></div></div><h1 class="logo"><a href="/" title="いくら寝ても眠たい"><span class="logo-text">いくら寝ても眠たい</span></a></h1></header><main><article><h1 class="article-title">middlemanとGitHub Pagesでブログを5分で開設！ほか盛りだくさん！</h1><div class="posted-date-wrapper"><i class="fa fa-clock-o"></i><span class="posted-date">December 03, 2015</span></div><div class="tag-labels"><a href="/tags/middleman/"><small class="tag-label">middleman</small></a><a href="/tags/github-pages/"><small class="tag-label">GitHub Pages</small></a></div><hr class="article-header-separator" /><p><img title="スクリーンショット 2015-12-03 10.12.07.png" alt="スクリーンショット 2015-12-03 10.12.07.png" src="https://qiita-image-store.s3.amazonaws.com/0/32480/cbe49151-d0bc-adad-6e62-aefe40039e79.png" /></p>

<h1 id="advent-calendar-のために、自分専用のブログを作ろう！">advent calendar のために、自分専用のブログを作ろう！</h1>

<p>と思い立った方は、是非見て行ってくださいね( <sup>ω^</sup> )  </p>

<p>仕事で <a href="https://middlemanapp.com">middleman</a> を触る機会があったため、これを機にちょっとまとめてみました。  </p>

<p>手元の環境は、以下です。  </p>

<p>* Mac OSX 10.10.5 Yosemite</p>

<p>GitHub のアカウントが無い場合は、早速作っておきましょう。 </p>

<p>アカウントが作れたら、<a href="https://help.github.com/articles/generating-ssh-keys/">ここ</a>を参考にSSH鍵の登録をしておきましょう。  </p>

<p>今回はテンプレートに <a href="https://github.com/5t111111/middleman-blog-drops-template">Drops</a> を使ってみます。<br>
テンプレートのインストール方法は、他のテンプレートでも同様です。</p>

<h2 id="最初に-drops-のインストール">最初に <code>Drops</code> のインストール</h2>

<p>ホームディレクトリに <code>.middleman</code> ディレクトリを作って、その中にインストールしておきます。</p>
<pre class="highlight plaintext"><code>cd ~/
mkdir .middleman
git clone https://github.com/5t111111/middleman-blog-drops-template.git ~/middleman/blog-drops
</code></pre>

<p>次に blog 関連のファイルを置くディレクトリを決めて、以下のコマンドで blog プロジェクトを作成 ＆ 初期化します。</p>
<pre class="highlight plaintext"><code>cd ~/
middleman init my_blog_project --template=blog-drops --skip-bundle
cd my_blog_project
bundle install --path vendor/bundle
</code></pre>

<p>Drops では以下も実行します。</p>
<pre class="highlight plaintext"><code>npm install
</code></pre>

<h1 id="github-pages">GitHub Pages</h1>

<p>公開するホストには <a href="https://pages.github.com">GitHub Pages</a> を選択しました。</p>

<h2 id="まずはリポジトリの作成">まずはリポジトリの作成</h2>

<p>GitHub の<a href="https://github.com/new">新規リポジトリ作成ページ</a> の <code>Repository name</code> に</p>
<pre class="highlight json"><code><span class="p">{</span><span class="err">username</span><span class="p">}</span><span class="err">.github.io</span><span class="w">
</span></code></pre>

<p>の <code>{username}</code> に自分のGitHubアカウントの名前を入力します。<br>
 自分の場合は、アカウント名を <a href="https://github.com/takkjoga">takkjoga</a> にしているので、</p>
<pre class="highlight plaintext"><code>takkjoga.github.io
</code></pre>

<p>になります。</p>

<h2 id="リモートリポジトリ">リモートリポジトリ</h2>

<p>自分の使いやすい git クライアントで、さっき作ったリポジトリを登録します。<br>
自分はターミナルで使用するのが慣れているので、以下のようになります。</p>
<pre class="highlight plaintext"><code>cd ~/my_blog_project
git init
git remote add origin git@github.com:takkjoga/takkjoga.github.io.git
</code></pre>

<h1 id="早速公開！">早速公開！</h1>

<p>何も考えず、以下のコマンドでデフォルトの状態を公開しちゃいます。</p>
<pre class="highlight plaintext"><code>bundle exec middleman build
bundle exec middleman deploy
</code></pre>

<p>デプロイが終わったら、<code>{username}.github.io</code> に早速アクセスしてみましょう。</p>

<p><img title="スクリーンショット 2015-12-03 10.46.46.png" alt="スクリーンショット 2015-12-03 10.46.46.png" src="https://qiita-image-store.s3.amazonaws.com/0/32480/ed259585-f1dd-6857-6dc8-7de72972c9c5.png" /></p>

<p>できた！！<br>
簡単だなぁ。。</p>

<h1 id="せっかくだし自分のドメインで公開したい">せっかくだし自分のドメインで公開したい</h1>

<p>自分用のサーバーにあてているドメインを持っている人なら、ブログにもそのドメインを使いたい人は少なくないと思います。<br>
GitHub Pagesにはカスタムドメイン設定ができる仕組みがあるようです。<br>
<a href="https://help.github.com/articles/adding-a-cname-file-to-your-repository/">ここ</a>に説明が書いてありますが、middleman の場合ちょっと手順が変わるので説明します。</p>

<h2 id="cnameファイルをコミット">CNAMEファイルをコミット</h2>

<p>GitHubの説明ページでは、ルートディレクトリに直接 <code>CNAME</code> ファイルを配置してありますが、<br>
middleman を使って公開する場合は、<code>source/</code> ディレクトリ以下のファイルがビルドされて配置されます。</p>

<p>というわけで、<code>source/CNAME</code> にファイルを作成して、開いたファイル設定したいドメインを記述します。<br>
自分は <code>takumi-onodera.work</code> というドメインを持っているので、以下のように記述しました。</p>
<pre class="highlight plaintext"><code>blog.takumi-onodera.work
</code></pre>

<p>ファイルの編集が終わったらデプロイしておきます。</p>
<pre class="highlight plaintext"><code>bundle exec middleman deploy
</code></pre>

<h2 id="dnsの設定">DNSの設定</h2>

<p>ドメインを管理しているサービスのDNSレコード管理ページなどで、<code>CNAME</code> を設定します。<br>
<code>CNAME</code>のvalueには、<code>{username}.github.io</code> を設定します。<br>
設定が完了したら、DNSの浸透を待つのみ。</p>

<h1 id="ブログのタイトルなどの設定">ブログのタイトルなどの設定</h1>

<p>middleman で設定を司っているのは、<code>config.rb</code> というファイルです。</p>

<p>Dropsテンプレートでは、<a href="http://qiita.com/5t111111/items/5e79a169b3162e2eab4c#ブログの構成">紹介ページ</a>があるので、参照しながら以下のような設定にしました。</p>
<pre class="highlight plaintext"><code>Time.zone = 'Tokyo'

set :site_url, 'http://blog.takumi-onodera.work'
set :site_title, 'いくら寝ても眠たい'
set :site_description, 'いくら寝ても眠たい人のブログ。プログラミングやたまにインフラ、あまり有名ではないミュージシャンのことについてダラダラ書いていきます。'
set :site_author, 'takkjoga'
set :site_author_profile, '株式会社ドリコムでRubyエンジニアをしております。変な音楽が大好きです。'
set :site_author_image, 'profile.png'
set :reverse_title, true
set :social_links,
    twitter: 'https://twitter.com/takkjoga',
    github: 'https://github.com/takkjoga'

</code></pre>

<h1 id="404ページを設定する">404ページを設定する</h1>

<p>存在しないURLにアクセスされたときに表示されるページを設定します。<br>
これにはちょっとファイルをいじる必要があります。<br>
<a href="https://help.github.com/articles/custom-404-pages/">ここ</a> に説明がありますが、ルートディレクトリに<code>404.html</code>というファイルが存在すれば、そのファイルが404ページとして表示されるようにです。</p>

<p>今回は blog_drops を使用しているので、あらかじめ用意されている404ページをちょっと修正します。<br>
<code>source/404.html.slim</code> のファイルの一番上に、<a href="http://jekyllrb.com/docs/frontmatter/">YAML front matter</a>形式で <code>directory_index: false</code> を追記します。</p>
<pre class="highlight plaintext"><code>---
directory_index: false
---

h1
  | 404
h3
  | Page not found
</code></pre>

<p>あとは、ビルドアンドデプロイ。</p>
<pre class="highlight plaintext"><code>bundle exec middleman build
bundle exec middleman deploy
</code></pre>

<p>デプロイが完了したら、ドメインに適当なパスを入力して確認してみましょう。</p>

<h1 id="記事を書こう">記事を書こう</h1>

<p>記事を書くためのコマンドが用意されています。<br>
タイトルに空白が含まれる場合は、ダブルクォーテーションが必要です。</p>
<pre class="highlight plaintext"><code>bundle exec middleman article "middlemanとGitHub Pagesでブログを5分で開設！ほか盛りだくさん！"
</code></pre>

<p>以下のように、<code>source/posts/2015-12-07-middlemanとGitHub Pagesでブログを5分で開設！ほか盛りだくさん！.html.md</code> というファイルが生成されます。</p>
<pre class="highlight plaintext"><code>== Blog Sources: posts/{year}-{month}-{day}-{title}.html (:prefix + :sources)
== LiveReload accepting connections from ws://192.168.xxx.xxx:xxxxx
      create  source/posts/2015-12-07-middlemanとGitHub Pagesでブログを5分で開設！ほか盛りだくさん！.html.md
</code></pre>

<p>このファイルに、マークダウンで記事を書いていきます。<br>
ファイルの上部にある YAML front matter形式 の <code>tags:</code> には、記事のタグをカンマ区切りで登録しておきます。</p>
<pre class="highlight plaintext"><code>---
title: middlemanとGitHub Pagesでブログを5分で開設！ほか盛りだくさん！
date: 2015-12-07 12:00 +0900
tags: middleman, GitHub Pages
---

</code></pre>

<h2 id="記事の確認">記事の確認</h2>

<p>middleman には Live Reload という機能があって、middleman サーバーをローカルで立ててブラウザでページを開いておくと、記事ファイルを保存したと同時にサーバーの自動更新とページのリロードを自動でやってくれます。</p>

<p>まずはローカルでサーバーを立てます。</p>
<pre class="highlight plaintext"><code>bundle exec middleman server
</code></pre>

<p>次に、 <a href="http://localhost:4567/">http://localhost:4567/</a> をブラウザで開きます。</p>

<p>何か文章を書いて、保存してみましょう。<br>
勝手にブラウザが更新されて、書いた内容が反映されていると思います。</p>

<h2 id="日本語タイトルがビルドできない。。">日本語タイトルがビルドできない。。</h2>

<p>記事を書き終えて、ビルドしようとしたときに、<br>
ここまでの設定だと、以下のエラーがでると思います。</p>
<pre class="highlight plaintext"><code>error  build/feed.xml
</code></pre>

<p>これは、日本語の含まれたタイトルをURIとして feex.xml として出力しようとしたときに、ascii 文字列だけにしてね💢と怒られているようです。</p>

<p>自分が選んだ解決方法は、記事のURIを <code>tags:</code> に設定したものを利用することです。</p>

<p><code>config.rb</code> を以下のように修正しました。</p>
<pre class="highlight plaintext"><code>activate :blog do |blog|
  blog.permalink = '{year}/{month}/{day}/{tags}.html'
  #                                      ^^^^^^
end
</code></pre>

<p>こうすることによって、出力される記事のURIが</p>
<pre class="highlight plaintext"><code>/2015/12/07/middleman-github-pages/
</code></pre>

<p>と出力されて、URIとしても何が書いてあるかわかりやすくていいと思います。<br>
ただし、<code>tags:</code> に日本語が登録できなくなりますが。。汗</p>

<h2 id="できたかな？">できたかな？</h2>

<p>5分では終わらなかったかもしれませんが、結構簡単にブログを作れてしまったのではないかなと思います。</p>

<p>自分はブログ無精なので、今後更新していくかは微妙なところですが、Drops テンプレートの見た目もすごく綺麗だし、アウトプットすべきことは山ほどあるので、前向きに今回作ったブログを更新していきたいと思います。</p>

<h1 id="他にもいろいろなテンプレート">他にもいろいろなテンプレート</h1>

<p>今回は Drops を使用しましたが、他にもたくさんテンプレートが用意されています。<br>
そのうちの一部を試してみたので、紹介します。</p>

<p>画像はSafariのレスポンシブデザインモードでスクショしました。<br>
５分でできる！をテーマにしているので、デフォルトのデザインのみ貼ってあります。</p>

<ul>
<li><p><a href="https://github.com/5t111111/middleman-blog-drops-template">middleman-blog-drops-template</a><br>
<img title="スクリーンショット 2015-12-01 20.23.47.png" alt="スクリーンショット 2015-12-01 20.23.47.png" src="https://qiita-image-store.s3.amazonaws.com/0/32480/dced97fb-3bc8-2eb2-ba7c-cd8fe6a8dd1f.png" /><br>
<img title="スクリーンショット 2015-12-01 20.24.01.png" alt="スクリーンショット 2015-12-01 20.24.01.png" src="https://qiita-image-store.s3.amazonaws.com/0/32480/8864015c-756f-c262-6a6a-c85bfa744c01.png" /></p>

<ul>
<li><a href="https://github.com/5t111111/middleman-blog-bourbon-template">middleman-blog-bourbon-template</a></li>
</ul></li>
</ul>

<p><code>Gemfile</code> で読み込んでいる <code>slim</code> のバージョンを上げないと <code>bundle exec middleman server</code> したときにエラーが出ました。</p>
<pre class="highlight plaintext"><code>-gem 'slim', '~&gt; 2.0.2'
+gem 'slim', '~&gt; 3.0.6'
</code></pre>

<p>あと、以下を追加。</p>
<pre class="highlight plaintext"><code>+$base-accent-color: #000000;
</code></pre>

<p><img title="スクリーンショット 2015-12-01 21.38.08.png" alt="スクリーンショット 2015-12-01 21.38.08.png" src="https://qiita-image-store.s3.amazonaws.com/0/32480/79ee0b5b-5513-82ec-014e-1fee81ca18a9.png" /><br>
<img title="スクリーンショット 2015-12-01 21.38.22.png" alt="スクリーンショット 2015-12-01 21.38.22.png" src="https://qiita-image-store.s3.amazonaws.com/0/32480/2c11ff3e-84f3-fc91-a15e-f36307ea6836.png" /></p>

<ul>
<li><a href="https://github.com/nathos/amicus">amicus</a>

<ul>
<li>要カスタマイズとのこと。</li>
</ul></li>
</ul>

<p><img title="スクリーンショット 2015-12-01 21.52.35.png" alt="スクリーンショット 2015-12-01 21.52.35.png" src="https://qiita-image-store.s3.amazonaws.com/0/32480/82711db6-be7c-817b-1726-c039dade2268.png" /></p>

<ul>
<li><a href="https://github.com/pzi/middleman-basis">middleman-basis</a>

<ul>
<li>デフォルトページはめちゃシンプルでションボリ.com。機能モリモリなので <code>bundle install</code> に時間もかかる。</li>
</ul></li>
</ul>

<p><img title="スクリーンショット 2015-12-01 22.03.57.png" alt="スクリーンショット 2015-12-01 22.03.57.png" src="https://qiita-image-store.s3.amazonaws.com/0/32480/1feda050-c9e6-f089-e9b8-e846082e1fa6.png" /></p>

<ul>
<li><a href="https://github.com/bryanbraun/franklin">franklin</a>

<ul>
<li>オンラインブックをイメージしてるようなので、落ち着いてて優しい雰囲気です。</li>
</ul></li>
</ul>

<p><img title="スクリーンショット 2015-12-01 22.29.44.png" alt="スクリーンショット 2015-12-01 22.29.44.png" src="https://qiita-image-store.s3.amazonaws.com/0/32480/240a09b1-43f0-9d4c-b673-47dc1e3adf3c.png" /><br>
<img title="スクリーンショット 2015-12-01 22.30.03.png" alt="スクリーンショット 2015-12-01 22.30.03.png" src="https://qiita-image-store.s3.amazonaws.com/0/32480/258ab21e-adaf-a729-d024-79745ec49139.png" /></p>

<h1 id="その他、middleman-の雑記">その他、middleman の雑記</h1>

<h2 id="未来の日時を指定したファイルをデプロイしても、反映されない。">未来の日時を指定したファイルをデプロイしても、反映されない。</h2>

<p>「このブログをあらかじめ作っておいて、あとAdvent Calendarに登録するだけやで！」とズルをしようと思いましたが、未来の日時に設定するとビルドしたときに、<code>build/</code> ディレクトリ以下に記事が作られないようです。</p>

<h2 id="rails-の-activerecord-を参照する">Rails の ActiveRecord を参照する</h2>

<p>Railsアプリの一部静的ページを middleman で作るとなった場合は、以下のことが参考になるかもなと思ったので、残しておきます。</p>

<h3 id="gemfile-に以下を追加">Gemfile に以下を追加</h3>
<pre class="highlight plaintext"><code>gem 'activerecord'
gem "mysql2", '~&gt; 0.3.13'
</code></pre>

<p>このとき、mysql2 のバージョンの指定をしないと、mysql2 が認識されないので注意</p>

<h3 id="config.rb-に以下を追加">config.rb に以下を追加</h3>
<pre class="highlight plaintext"><code>require 'active_record'
require 'yaml'

config = YAML.load_file('../config/database.yml')

ActiveRecord::Base.establish_connection config['development']
ActiveRecord::Base.logger = Logger.new(STDERR) # ログにSQLを出力

# 各Modelを使えるようにする
Dir.glob("../app/models/**/*.rb").each do |file|
  require_dependency file
end
</code></pre>

<p>上記を外部ファイルにするとき、自分は最初ファイル名を active_record.rb として保存していたが、</p>
<pre class="highlight plaintext"><code>/path/to/project/middleman/active_record.rb:6:in `&lt;top (required)&gt;': uninitialized constant ActiveRecord (NameError)
</code></pre>

<p>のエラーが出続けて悩みました。。</p>

<h3 id="modelが使えない場合">Modelが使えない場合</h3>

<p>以下のようなエラーが出る場合</p>
<pre class="highlight plaintext"><code>/path/to/project/app/models/hoge.rb:28:in `&lt;class:Hoge&gt;': uninitialized constant Hoge::Rails (NameError)
</code></pre>

<p>Railsのシガラミに囚われてしまっているので、下記のように書き換えてリレーション周りを再定義します。</p>
<pre class="highlight plaintext"><code>Dir.glob("../app/models/*.rb") do |file|
  self.class.const_set File.basename(file, '.rb').camelize, Class.new(ActiveRecord::Base)
end

class Hoge &lt; ActiveRecord::Base
  has_many :fugas
end

class Fuga &lt; ActiveRecord::Base
  belongs_to :hoge
end
</code></pre>
<div class="social"></div></article></main><footer><div class="footer-wrapper"><div class="author"><div class="image-wrapper"><a href="/author/"><img alt="author" src="/images/profile-dc841565.png" /></a></div></div><div class="copyright"><i class="fa fa-copyright"></i> 2015 <a href="/">いくら寝ても眠たい</a> - takkjoga</div></div></footer></body></html>